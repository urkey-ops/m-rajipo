<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mission Rajipo - Custom Audio Player</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  #trackList {
    height: 60vh;
    overflow-y: auto;
  }
  .highlight-group {
    background-color: #fef3c7; /* Tailwind yellow-100 */
  }
</style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

<header class="bg-blue-600 text-white text-center p-4 shadow">
  <h1 class="text-xl font-bold">üéµ Mission Rajipo</h1>
  <p class="text-sm">Select tracks, set repeats, and play your mix</p>
</header>

<!-- Controls -->
<div class="p-4 bg-white shadow flex flex-col md:flex-row items-center gap-2 flex-wrap">
  <input type="text" id="searchBar" placeholder="üîé Search by track number or name..." 
    class="flex-1 p-2 border rounded-lg focus:ring focus:ring-blue-300">

  <input type="number" id="repeatCount" min="1" placeholder="Repeats" 
    class="w-24 p-2 border rounded-lg text-center">

  <select id="trackGroup" class="p-2 border rounded-lg">
    <option value="">Select Track Group</option>
    <option value="1-10">Tracks 1‚Äì10</option>
    <option value="11-20">Tracks 11‚Äì20</option>
    <option value="21-30">Tracks 21‚Äì30</option>
  </select>

  <button id="toggleSelectBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
    Select All
  </button>
</div>

<!-- Track List -->
<main id="trackList" class="p-4 bg-white shadow rounded-lg"></main>

<!-- Footer Controls -->
<footer class="bg-white shadow p-4 sticky bottom-0">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <label class="flex items-center gap-2">
      <input type="checkbox" id="shuffle" class="w-5 h-5">
      <span class="text-sm">Shuffle</span>
    </label>
    <label class="flex items-center gap-2">
      <input type="checkbox" id="repeatPlaylist" class="w-5 h-5">
      <span class="text-sm">Repeat Playlist</span>
    </label>
    <button onclick="startPlaylist()" 
      class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow">
      ‚ñ∂Ô∏è Play Selected
    </button>
  </div>

  <div class="flex items-center gap-2 mt-2">
    <span class="text-sm font-medium">Speed:</span>
    <button onclick="changeSpeed(-0.1)" class="bg-gray-300 px-2 py-1 rounded">-</button>
    <span id="speedDisplay" class="w-10 text-center">1.0√ó</span>
    <button onclick="changeSpeed(0.1)" class="bg-gray-300 px-2 py-1 rounded">+</button>
  </div>

  <audio id="audioPlayer" controls class="w-full mt-2"></audio>
</footer>

<script>
// Example for first 20 tracks from Internet Archive
const audioFiles = [
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_001.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_002.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_003.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_004.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_005.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_006.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_007.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_008.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_009.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_010.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_011.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_012.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_013.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_014.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_015.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_016.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_017.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_018.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_019.mp3",
  "https://ia601703.us.archive.org/35/items/satsang_diksha/gujarati_020.mp3"
];

const trackListDiv = document.getElementById("trackList");
const searchBar = document.getElementById("searchBar");
const toggleSelectBtn = document.getElementById("toggleSelectBtn");
const repeatCountInput = document.getElementById("repeatCount");
const audioPlayer = document.getElementById("audioPlayer");
const speedDisplay = document.getElementById("speedDisplay");
const trackGroupSelect = document.getElementById("trackGroup");

let currentSpeed = 1.0;
audioPlayer.playbackRate = currentSpeed;

function changeSpeed(delta){
  currentSpeed = Math.round(Math.min(1.5, Math.max(0.5, currentSpeed + delta)) * 10)/10;
  audioPlayer.playbackRate = currentSpeed;
  speedDisplay.textContent = currentSpeed.toFixed(1)+"√ó";
}

let trackElements = [];
audioFiles.forEach((file,i)=>{
  let div = document.createElement("div");
  div.className = "track-item flex items-center justify-between bg-white rounded-lg p-3 mb-2 shadow";
  div.dataset.trackNumber = i+1;
  div.dataset.trackName = `Shloka ${i+1}`.toLowerCase();
  div.innerHTML = `
    <div class="flex items-center gap-3">
      <input type="checkbox" value="${i}" class="track-checkbox w-5 h-5">
      <span class="text-gray-800 font-medium">Shloka ${i+1}</span>
    </div>
  `;
  trackListDiv.appendChild(div);
  trackElements.push(div);
});

searchBar.addEventListener("input", ()=>{
  const query = searchBar.value.toLowerCase().trim();
  trackElements.forEach(el=>{
    const number = el.dataset.trackNumber;
    const name = el.dataset.trackName;
    el.style.display = (number.includes(query)||name.includes(query))?"flex":"none";
  });
});

let allSelected = false;
toggleSelectBtn.addEventListener("click", ()=>{
  allSelected = !allSelected;
  document.querySelectorAll(".track-checkbox").forEach(cb=>{
    if(cb.closest(".track-item").style.display!=="none") cb.checked=allSelected;
  });
  toggleSelectBtn.textContent = allSelected?"Clear All":"Select All";
});

trackGroupSelect.addEventListener("change", ()=>{
  const value = trackGroupSelect.value;
  if(!value) {
    trackElements.forEach(el=>el.classList.remove("highlight-group"));
    return;
  }
  const [start,end] = value.split("-").map(Number);
  trackElements.forEach(el=>{
    const num = parseInt(el.dataset.trackNumber);
    if(num>=start && num<=end){
      el.classList.add("highlight-group");
    } else {
      el.classList.remove("highlight-group");
    }
  });
  const firstTrack = trackElements.find(el=>{
    const num = parseInt(el.dataset.trackNumber);
    return num>=start && num<=end;
  });
  if(firstTrack) firstTrack.scrollIntoView({behavior:"smooth"});
});

let playQueue = [];
let currentTrackIndex = 0;
let currentRepeat = 0;
let repeatPlaylist = false;

function startPlaylist(){
  const repeatCount = repeatCountInput.value?parseInt(repeatCountInput.value):1;
  const selected = [...document.querySelectorAll("#trackList input[type='checkbox']:checked")];
  playQueue = selected.map(cb=>({file:audioFiles[cb.value],repeat:repeatCount}));
  if(document.getElementById("shuffle").checked) playQueue = shuffleArray(playQueue);
  repeatPlaylist = document.getElementById("repeatPlaylist").checked;
  currentTrackIndex = 0; currentRepeat=0;
  if(playQueue.length>0) playCurrentTrack();
}

function playCurrentTrack(){
  const track = playQueue[currentTrackIndex];
  if(!track) return;
  audioPlayer.src = track.file;
  audioPlayer.play();
}

audioPlayer.addEventListener("ended", ()=>{
  const track = playQueue[currentTrackIndex];
  if(!track) return;
  if(currentRepeat<track.repeat-1){
    currentRepeat++;
    playCurrentTrack();
  } else {
    currentRepeat=0; currentTrackIndex++;
    if(currentTrackIndex<playQueue.length){
      playCurrentTrack();
    } else if(repeatPlaylist && playQueue.length>0){
      currentTrackIndex=0; currentRepeat=0; playCurrentTrack();
    }
  }
});

function shuffleArray(array){
  let shuffled=[...array];
  for(let i=shuffled.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]];
  }
  return shuffled;
}
</script>
</body>
</html>
