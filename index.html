

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Rajipo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      padding-bottom: 100px; /* buffer so list not hidden under player */
    }
    footer {
      padding-bottom: 1.5rem; /* extra breathing room below */
    }
    audio#audioPlayer {
      width: 100%;
      height: 55px;
      margin-bottom: 1rem;
    }
    #trackList {
      height: 70vh;
      overflow-y: auto;
    }
    .track-item {
      padding: 0.75rem;
      font-size: 1rem;
    }
    .track-item input[type="checkbox"] {
      width: 22px;
      height: 22px;
    }
  </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

  <!-- Header -->
  <header class="p-4 bg-green-600 text-white text-center text-xl font-bold shadow">
    Mission Rajipo â€“ Shloka Player
  </header>

  <!-- Controls -->
  <div class="p-4 bg-white shadow flex flex-col sm:flex-row items-center gap-2 flex-wrap">
    <!-- Search -->
    <input type="text" id="searchBar" onkeyup="filterTracks()" placeholder="Search by number..." class="p-2 border rounded w-full sm:w-64">
    
    <!-- Range Selection -->
    <div class="flex gap-2 items-center mt-2 sm:mt-0">
      <label class="text-sm">Select range:</label>
      <input type="number" id="rangeStart" class="w-20 p-2 border rounded text-center" placeholder="Start">
      <input type="number" id="rangeEnd" class="w-20 p-2 border rounded text-center" placeholder="End">
      <button onclick="selectRange()" class="px-3 py-2 bg-green-500 text-white rounded">Select</button>
    </div>

    <!-- Repeat count -->
    <div class="flex items-center gap-2">
      <label for="repeatCount">Repeat each:</label>
      <input type="number" id="repeatCount" value="1" min="1" class="w-20 p-2 border rounded text-center">
    </div>

    <!-- Playback speed -->
    <div class="flex items-center gap-2">
      <label for="speedControl">Speed:</label>
      <button onclick="changeSpeed(-0.1)" class="px-2 py-1 bg-gray-300 rounded">-</button>
      <span id="speedDisplay">1.0x</span>
      <button onclick="changeSpeed(0.1)" class="px-2 py-1 bg-gray-300 rounded">+</button>
    </div>

    <!-- Shuffle & Repeat -->
    <div class="flex items-center gap-2">
      <label><input type="checkbox" id="shuffle"> Shuffle</label>
      <label><input type="checkbox" id="repeatPlaylist"> Repeat Playlist</label>
    </div>

    <button onclick="playSelected()" class="px-4 py-2 bg-blue-500 text-white rounded">Play Selected</button>
  </div>

  <!-- Track List -->
  <main class="flex-1 p-4">
    <ul id="trackList" class="space-y-1">
      <!-- Populated by JS -->
    </ul>
  </main>

  <!-- Player -->
  <footer class="bg-white shadow p-4 sticky bottom-0">
    <audio id="audioPlayer" controls></audio>
  </footer>

  <script>
    const audioFiles = [];
    for (let i = 1; i <= 315; i++) {
      const num = String(i).padStart(3, '0');
      audioFiles.push({
        name: "Shloka " + i,
        src: `https://ia601703.us.archive.org/35/items/satsang_diksha/sanskrit_${num}.mp3`
      });
    }

    const trackList = document.getElementById("trackList");
    const audioPlayer = document.getElementById("audioPlayer");
    let playQueue = [];
    let currentTrack = 0;
    let repeatCount = 1;
    let playbackSpeed = 1.0;

    // Populate track list
    audioFiles.forEach((track, index) => {
      const li = document.createElement("li");
      li.className = "track-item flex items-center gap-2";
      li.innerHTML = `
        <input type="checkbox" data-index="${index}">
        <span>${track.name}</span>
      `;
      trackList.appendChild(li);
    });

    // Filter tracks
    function filterTracks() {
      const search = document.getElementById("searchBar").value.toLowerCase();
      document.querySelectorAll("#trackList .track-item").forEach((item, index) => {
        const match = audioFiles[index].name.toLowerCase().includes(search);
        item.style.display = match ? "" : "none";
      });
    }

    // Select range
    function selectRange() {
      const start = parseInt(document.getElementById('rangeStart').value);
      const end = parseInt(document.getElementById('rangeEnd').value);

      if (isNaN(start) || isNaN(end) || start < 1 || end < start) {
        alert("Please enter a valid range (e.g., 11 to 20).");
        return;
      }

      document.querySelectorAll('#trackList .track-item input[type="checkbox"]').forEach((checkbox, index) => {
        const trackNum = index + 1;
        if (trackNum >= start && trackNum <= end) {
          checkbox.checked = true;
        }
      });
    }

    // Change speed
    function changeSpeed(delta) {
      playbackSpeed = Math.min(1.5, Math.max(0.5, playbackSpeed + delta));
      audioPlayer.playbackRate = playbackSpeed;
      document.getElementById("speedDisplay").textContent = playbackSpeed.toFixed(1) + "x";
    }

    // Play selected
    function playSelected() {
      playQueue = [];
      currentTrack = 0;
      repeatCount = parseInt(document.getElementById("repeatCount").value) || 1;
      const shuffle = document.getElementById("shuffle").checked;

      document.querySelectorAll('#trackList input[type="checkbox"]:checked').forEach(cb => {
        const track = audioFiles[cb.dataset.index];
        for (let i = 0; i < repeatCount; i++) {
          playQueue.push(track);
        }
      });

      if (shuffle) {
        playQueue = playQueue.sort(() => Math.random() - 0.5);
      }

      if (playQueue.length > 0) {
        playTrack(0);
      }
    }

    function playTrack(index) {
      if (index >= playQueue.length) {
        if (document.getElementById("repeatPlaylist").checked) {
          playSelected();
        }
        return;
      }
      currentTrack = index;
      audioPlayer.src = playQueue[index].src;
      audioPlayer.playbackRate = playbackSpeed;
      audioPlayer.play();
    }

    audioPlayer.addEventListener("ended", () => {
      playTrack(currentTrack + 1);
    });
  </script>
</body>
</html>
