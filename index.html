<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Player</title>
    <!-- Tailwind CSS for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #E0E0E0;
        }
        /* Custom scrollbar for track list */
        #track-list::-webkit-scrollbar {
            width: 8px;
        }
        #track-list::-webkit-scrollbar-track {
            background: #252525;
            border-radius: 10px;
        }
        #track-list::-webkit-scrollbar-thumb {
            background: #4A4A4A;
            border-radius: 10px;
        }
        .track-item.selected {
            background-color: #2F2F2F;
            border-left: 4px solid #6A5ACD;
        }
        .track-item.selected .checkmark {
            display: inline;
        }
        .checkmark {
            display: none;
            color: #6A5ACD;
            margin-left: 8px;
        }
        .group-btn:hover {
            background-color: #4A4A4A;
        }
        .group-btn.selected {
            background-color: #6A5ACD;
            color: #FFFFFF;
        }
        .group-btn.selected .checkmark {
            display: inline;
            color: #FFFFFF;
        }
        /* Style for the progress bar */
        #progress-bar {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: #4A4A4A;
            border-radius: 5px;
            cursor: pointer;
            outline: none;
        }
        #progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #6A5ACD;
            border-radius: 50%;
            cursor: pointer;
        }
        #progress-bar::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #6A5ACD;
            border-radius: 50%;
            cursor: pointer;
        }
        .icon-btn {
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .icon-btn:hover {
            color: #6A5ACD;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-xl mx-auto p-6 bg-[#181818] rounded-xl shadow-lg border border-[#252525]">
        <h1 class="text-2xl font-bold mb-4 text-center text-white">Audio Player</h1>

        <!-- Groups Section -->
        <div class="mb-4">
            <h2 class="text-lg font-semibold mb-2">Groups (10 tracks each)</h2>
            <div id="groups" class="flex flex-wrap items-center justify-center">
                <!-- Group buttons will be generated here by JavaScript -->
            </div>
        </div>

        <!-- Track List Section -->
        <div id="track-list" class="h-64 overflow-y-auto mb-4 bg-[#1F1F1F] rounded-lg p-2">
            <!-- Tracks will be generated here by JavaScript -->
        </div>

        <!-- Player Controls -->
        <div id="player-controls" class="flex items-center justify-between mt-4">
            <i id="prev-btn" class="fas fa-backward icon-btn"></i>
            <i id="play-pause-btn" class="fas fa-play-circle icon-btn text-4xl mx-4"></i>
            <i id="next-btn" class="fas fa-forward icon-btn"></i>
        </div>

        <!-- Progress Bar and Timer -->
        <div class="flex items-center space-x-2 mt-4">
            <span id="timer" class="text-sm">00:00</span>
            <input type="range" id="progress-bar" value="0" step="0.01" class="flex-grow">
            <span id="duration" class="text-sm">00:00</span>
        </div>

        <!-- Additional Controls -->
        <div class="flex items-center justify-center mt-4 space-x-6">
            <i id="shuffle-btn" class="fas fa-random icon-btn opacity-50"></i>
            <i id="loop-btn" class="fas fa-redo-alt icon-btn opacity-50"></i>
        </div>

    </div>

    <script>
        // Global variables for the player state
        let audio = new Audio();
        const totalTracks = 100;
        const allTracks = Array.from({ length: totalTracks }, (_, i) => ({
            id: i + 1,
            name: `Track ${i + 1}`,
            url: `https://p.scdn.co/mp3-preview/a8947d1b3337a71f021e16f6b96b341c2c3664d6?cid=774b29d4f13844c495f206caf452410a` // A single preview URL for simplicity
        }));
        let selectedTracks = [];
        let currentTrackIndex = 0;
        let isLooping = false;
        let isShuffling = false;

        /**
         * Initializes the audio player by generating tracks and groups.
         */
        function initializeAudioPlayer() {
            generateTracks();
            generateGroups();
            updatePlayerUI();
            addEventListeners();
        }

        /**
         * Generates the list of 100 tracks in the UI.
         */
        function generateTracks() {
            const trackListDiv = document.getElementById("track-list");
            trackListDiv.innerHTML = "";
            allTracks.forEach(track => {
                const trackItem = document.createElement("div");
                trackItem.className = "track-item flex items-center justify-between p-2 rounded cursor-pointer transition-colors duration-200 hover:bg-[#2A2A2A]";
                trackItem.dataset.id = track.id;
                trackItem.innerHTML = `<span class="truncate">${track.name}</span><span class="checkmark">✓</span>`;
                trackItem.onclick = () => toggleTrack(track, trackItem);
                trackListDiv.appendChild(trackItem);
            });
        }

        /**
         * Generates group buttons for every 10 tracks.
         */
        function generateGroups() {
            const groupDiv = document.getElementById("groups");
            groupDiv.innerHTML = "";
            for (let i = 1; i <= totalTracks; i += 10) {
                const end = Math.min(i + 9, totalTracks);
                const btn = document.createElement("button");
                // CORRECTED LINE: This adds the 'group-btn' class back
                btn.className = "group-btn bg-[#2F2F2F] text-white px-3 py-1 m-1 rounded transition-colors duration-200 hover:bg-gray-600";
                btn.dataset.start = i;
                btn.dataset.end = end;
                btn.innerHTML = `${i}–${end}<span class="checkmark">✓</span>`;
                btn.onclick = () => toggleGroup(i, end, btn);
                groupDiv.appendChild(btn);
            }
        }

        /**
         * Toggles the selection of a group of tracks.
         * @param {number} start - The starting track number of the group.
         * @param {number} end - The ending track number of the group.
         * @param {HTMLElement} btn - The group button element.
         */
        function toggleGroup(start, end, btn) {
            btn.classList.toggle("selected");
            const isSelected = btn.classList.contains("selected");

            // Find all track items within the selected range
            const trackItems = document.querySelectorAll("#track-list .track-item");
            for (let i = start; i <= end; i++) {
                const trackItem = trackItems[i - 1]; // Array is 0-indexed
                if (isSelected) {
                    trackItem.classList.add("selected");
                    if (!selectedTracks.includes(allTracks[i - 1])) {
                        selectedTracks.push(allTracks[i - 1]);
                    }
                } else {
                    trackItem.classList.remove("selected");
                    selectedTracks = selectedTracks.filter(track => track.id !== allTracks[i - 1].id);
                }
            }
            updatePlayerUI();
        }

        /**
         * Toggles the selection of a single track.
         * @param {object} track - The track object to toggle.
         * @param {HTMLElement} trackItem - The HTML element of the track.
         */
        function toggleTrack(track, trackItem) {
            trackItem.classList.toggle("selected");
            if (trackItem.classList.contains("selected")) {
                selectedTracks.push(track);
            } else {
                selectedTracks = selectedTracks.filter(t => t.id !== track.id);
            }
            updateGroupButtonSelection();
            updatePlayerUI();
        }

        /**
         * Updates the visual state of group buttons based on selected tracks.
         */
        function updateGroupButtonSelection() {
            const groupButtons = document.querySelectorAll("#groups .group-btn");
            groupButtons.forEach(btn => {
                const start = parseInt(btn.dataset.start);
                const end = parseInt(btn.dataset.end);
                const tracksInGroup = allTracks.slice(start - 1, end);
                const allSelected = tracksInGroup.every(track => selectedTracks.some(t => t.id === track.id));

                if (allSelected) {
                    btn.classList.add("selected");
                } else {
                    btn.classList.remove("selected");
                }
            });
        }

        /**
         * Updates the player UI elements like button states and track names.
         */
        function updatePlayerUI() {
            const playPauseBtn = document.getElementById("play-pause-btn");
            const progressBar = document.getElementById("progress-bar");
            const prevBtn = document.getElementById("prev-btn");
            const nextBtn = document.getElementById("next-btn");
            const shuffleBtn = document.getElementById("shuffle-btn");
            const loopBtn = document.getElementById("loop-btn");

            // Update play/pause button icon
            playPauseBtn.className = audio.paused ? 'fas fa-play-circle icon-btn text-4xl mx-4' : 'fas fa-pause-circle icon-btn text-4xl mx-4';
            
            // Disable/enable controls based on selection
            const hasTracks = selectedTracks.length > 0;
            const controls = [playPauseBtn, progressBar, prevBtn, nextBtn, shuffleBtn, loopBtn];
            controls.forEach(control => {
                if (control) {
                    if (hasTracks) {
                        control.classList.remove("opacity-50", "cursor-not-allowed");
                        control.style.pointerEvents = "auto";
                    } else {
                        control.classList.add("opacity-50", "cursor-not-allowed");
                        control.style.pointerEvents = "none";
                    }
                }
            });
            
            // Set track duration if audio is loaded
            if (audio.readyState > 0) {
                document.getElementById('duration').textContent = formatTime(audio.duration);
            }
        }

        /**
         * Toggles audio play/pause.
         */
        function playAudio() {
            if (selectedTracks.length === 0) return;

            if (audio.paused) {
                if (!audio.src) {
                    // Start playing the first selected track
                    audio.src = selectedTracks[currentTrackIndex].url;
                    audio.play();
                } else {
                    audio.play();
                }
            } else {
                audio.pause();
            }
            updatePlayerUI();
        }

        /**
         * Plays the next track in the selected list.
         */
        function playNext() {
            if (selectedTracks.length === 0) return;
            currentTrackIndex = (currentTrackIndex + 1) % selectedTracks.length;
            audio.src = selectedTracks[currentTrackIndex].url;
            audio.play();
            updatePlayerUI();
        }

        /**
         * Plays the previous track in the selected list.
         */
        function playPrev() {
            if (selectedTracks.length === 0) return;
            currentTrackIndex = (currentTrackIndex - 1 + selectedTracks.length) % selectedTracks.length;
            audio.src = selectedTracks[currentTrackIndex].url;
            audio.play();
            updatePlayerUI();
        }

        /**
         * Shuffles the selected tracks randomly.
         */
        function shuffleTracks() {
            if (selectedTracks.length === 0) return;
            isShuffling = !isShuffling;
            const shuffleBtn = document.getElementById("shuffle-btn");
            shuffleBtn.classList.toggle("text-[#6A5ACD]", isShuffling);
            if (isShuffling) {
                // Fisher-Yates shuffle algorithm
                for (let i = selectedTracks.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [selectedTracks[i], selectedTracks[j]] = [selectedTracks[j], selectedTracks[i]];
                }
            } else {
                // Sort back to original order if shuffling is turned off
                selectedTracks.sort((a, b) => a.id - b.id);
            }
        }

        /**
         * Toggles looping for the current track.
         */
        function loopCurrentTrack() {
            isLooping = !isLooping;
            const loopBtn = document.getElementById("loop-btn");
            audio.loop = isLooping;
            loopBtn.classList.toggle("text-[#6A5ACD]", isLooping);
        }

        /**
         * Formats time from seconds to MM:SS format.
         * @param {number} seconds - The time in seconds.
         * @returns {string} The formatted time string.
         */
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        /**
         * Adds all necessary event listeners to UI elements.
         */
        function addEventListeners() {
            const playPauseBtn = document.getElementById("play-pause-btn");
            const progressBar = document.getElementById("progress-bar");
            const nextBtn = document.getElementById("next-btn");
            const prevBtn = document.getElementById("prev-btn");
            const shuffleBtn = document.getElementById("shuffle-btn");
            const loopBtn = document.getElementById("loop-btn");

            playPauseBtn.addEventListener('click', playAudio);
            nextBtn.addEventListener('click', playNext);
            prevBtn.addEventListener('click', playPrev);
            shuffleBtn.addEventListener('click', shuffleTracks);
            loopBtn.addEventListener('click', loopCurrentTrack);

            audio.addEventListener('timeupdate', () => {
                const timer = document.getElementById("timer");
                progressBar.value = (audio.currentTime / audio.duration) * 100;
                timer.textContent = formatTime(audio.currentTime);
            });

            audio.addEventListener('ended', () => {
                playNext();
            });

            audio.addEventListener('loadedmetadata', () => {
                const duration = document.getElementById("duration");
                duration.textContent = formatTime(audio.duration);
            });

            progressBar.addEventListener('input', () => {
                const time = (progressBar.value / 100) * audio.duration;
                audio.currentTime = time;
            });
        }

        // Initialize the player when the DOM is ready
        window.onload = initializeAudioPlayer;
    </script>
</body>
</html>
